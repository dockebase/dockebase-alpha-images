services:
  dockebase-api:
    image: ghcr.io/dockebase/dockebase-alpha-images/api:latest
    container_name: dockebase-api
    volumes:
      - dockebase-data:/app/backend/data
      - /var/run/docker.sock:/var/run/docker.sock
    environment:
      - NODE_ENV=production
      - BETTER_AUTH_SECRET=${AUTH_SECRET}
      - BETTER_AUTH_URL=${BASE_URL}
      - DOCKEBASE_INSTANCE_URL=${BASE_URL}
      - CADDY_ADMIN_URL=http://dockebase-caddy:2019
      - TRAEFIK_API_URL=http://dockebase-traefik:8080
      - ACME_EMAIL=${ACME_EMAIL}
      # Proxy initialization (read at startup)
      - DOCKEBASE_INIT_DOMAIN=${DOMAIN}
      - DOCKEBASE_INIT_EMAIL=${ACME_EMAIL}
      - DOCKEBASE_INIT_PROVIDER=${PROXY_PROVIDER}
    restart: unless-stopped
    networks:
      - dockebase-internal

  dockebase-ui:
    image: ghcr.io/dockebase/dockebase-alpha-images/ui:latest
    container_name: dockebase-ui
    ports:
      - "9000:80"  # Fallback HTTP access when proxy is disabled
    restart: unless-stopped
    networks:
      - dockebase-internal

volumes:
  dockebase-data:

networks:
  dockebase-internal:
    name: dockebase-internal
    external: true
